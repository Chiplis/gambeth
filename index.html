<head>
    <title>Gambeth</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.umd.min.js"></script>
    <script src="gambeth-oo-abi.js"></script>
    <script src="gambeth-provable-abi.js"></script>
    <script src="gambeth-state-abi.js"></script>
    <script src="token-abi.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <link rel="stylesheet" href="gambeth.css">
    <link rel=“shortcut icon” href="/favicon.ico" type=“image/x-icon”>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans&family=Saira:wght@100;500&family=Poppins&display=swap"
          rel="stylesheet">
    <link rel=“icon” href="/favicon.ico" type=“image/x-icon”>
</head>

<body style="margin: 0">
<div
        style="padding: 5px; box-shadow: rgba(0, 0, 0, 0.5) 0px 3px 8px; border: 0; min-height:50px; background-color: #02024b; width: 100%; position: fixed; left: 0; display: flex; flex-direction: row; justify-content: space-around; align-items: center;">
    <div style="display: flex; flex-direction: row; justify-content: center; align-items: center">
        <img src="gambeth.svg" alt="Gambeth" style="width: 4vw"/>
        <div style="font-size: 250%; font-family: Saira, sans-serif; text-transform: lowercase">Gambeth</div>
    </div>
    <label for="search-bet" hidden></label>
    <input style="max-width: 20vw; outline: 0; margin: 0" class="msg search" type="search" placeholder="Search" id="search-bet">
    <div style="display: flex">
        <div class="btn link create-bet" style="color:white; border: 0" onclick="createBetBtn()">
            Create Market
        </div>
    </div>
</div>

<div style="display: flex; align-items: flex-start; justify-content: space-around;">
    <div
            style="display: flex; margin-top: 5rem; align-items: center; flex-direction: column; justify-content: center;">
        <div id="default-message-location"
             style="width: 0; height: 0; display: flex; flex-direction:column; justify-content: center">
            <button class="btn"
                    style="visibility: hidden; border: 2px solid black; position: fixed; width: 100%; border-radius: 0; opacity: 0; top: 0; flex-direction: column; justify-content: space-around;"
                    id="message">
                <div id="close-message"
                     style="color: #f3f9d2; margin-left: auto; margin-bottom: 0.25em; align-self: flex-start"
                     onclick="hideMessage()">✖
                </div>
                <div id="inner-message"
                     style="display: flex; align-items: center; justify-content: center; color: #f3f9d2"></div>
            </button>
        </div>
        <div id="new-bet"
             style="width: 70vw; display: none; flex-direction: row; justify-content: space-between; align-items: center">
            <div class="btn" style="color:white; background-color: #ed7b64; align-self: flex-start;"
                 onclick="renderPreviousCreationStep()">←
            </div>
            <div style="width: 70%">
                <div class="create-bet-step"
                     style="visibility: visible; opacity: 0; transition: opacity 0.5s cubic-bezier(1, 2, 3, 4); position: absolute; top: 5em; display: flex;flex-direction: column; justify-content: center; align-items: center">
                    <div class="" style="border: 0; margin: 0">Pick a name</div>
                    <input id="create-bet-id" oninput="betIdChanged()"
                           style="margin: 0.5rem;" type="text"/>
                    <label id="create-bet-id-label" for="create-bet-id"></label>
                </div>
                <div class="create-bet-step"
                     style="visibility: hidden; opacity: 0; transition: opacity 0.5s linear; position: absolute; top: 5em; display: flex;flex-direction: column; justify-content: center; align-items: center">
                    <div class="" style="border: 0; margin: 0">Query</div>
                    <label for="create-bet-schema" style="margin-top: 1em">How should the contract determine the outcome
                        of your bet?</label>
                    <select onchange="changeBetType()" style="color: #f3f9d2; margin: 1rem; text-align: center"
                            name="create-bet-schema" id="create-bet-schema">
                        <option value="oo" selected>Optimistic oracle decision</option>
                        <option value="bc">Bet creator's decision</option>
                        <option value="wa">OoAlpha oracle query</option>
                        <option value="xml">XML oracle query</option>
                        <option value="json">JSON oracle query</option>
                        <option value="html">Process HTML data</option>
                    </select>
                    <label style="display: none" for="create-bet-url">Determine bet outcome by choosing the website
                        which
                        contains it</label>
                    <input style="display: none"
                           oninput="createBetQueryInner.innerHTML=parseBetQuery(createBetSchema.value, this.value, createBetPath.value)"
                           id="create-bet-url" type="text"
                           placeholder="https://www.therocktrading.com/api/ticker/BTCEUR"
                           style="width: 75%; margin-top: 1em"/>
                    <label for="create-bet-oo">What will the bet determine?</label>
                    <input id="create-bet-oo" type="text" placeholder="Winner of the 2038 Super Bowl"
                           style="width: 75%; margin-top: 1em"/>
                    <label style="display: none" for="create-bet-path" id="create-bet-path-label"></label>
                    <input style="display: none"
                           oninput="createBetQueryInner.innerHTML=parseBetQuery(createBetSchema.value, createBetUrl.value, createBetPath.value)"
                           id="create-bet-path" type="text" placeholder=".outcome.0.last"
                           style="width: 75%; margin-top: 1em"/>

                    <div id="create-bet-query"
                         style="display: flex; margin-top: 1em; flex-direction: column; align-items: center">
                        <div id="create-bet-query-inner"></div>
                    </div>
                    <div id="create-bet-query-outcome"></div>
                </div>
                <div class="create-bet-step" id="create-bet-choices"
                     style="display: none; flex-direction: column; justify-content: center; visibility: hidden">
                    <div class="" style="display: flex; justify-content: center; border: 0; margin: 0">Outcomes</div>
                    <label id="create-bet-choice-label" for="create-bet-choice"
                           style="display: flex; justify-content: center">
                        Add the possible outcomes for the market you're creating
                    </label>
                    <div style="display: flex; justify-content: center; align-items: center">
                        <input id="create-bet-choice" style="margin: 0.5rem;"/>
                        <div onclick="addBetChoice()" style="cursor: pointer">+</div>
                    </div>
                    <ul id="create-bet-choices-list"
                        style="display: flex; flex-direction: column; align-items: center; justify-content: center"></ul>
                </div>
                <div class="create-bet-step" style="display: none; flex-direction: column; justify-content: center; visibility: hidden">
                    <div class="" style="display: flex; justify-content: center; border: 0; margin: 0">Odds</div>
                    <label id="create-bet-odds-label" for="create-bet-choice"
                           style="display: flex; justify-content: center">
                        Add the odds for each possible outcome (must add up to 100%)
                    </label>
                    <div style="display: flex; justify-content: center">
                        <ul id="create-bet-odds-list" style="display: flex; flex-direction: column; align-items: center; justify-content: center">
                        </ul>
                        <div id="create-bet-odds" style="display: flex; flex-direction: column; align-items: center; justify-content: center">
                        </div>
                    </div>

                </div>
                <div class="create-bet-step"
                     style="visibility: hidden; opacity: 0; transition: opacity 0.5s linear; position: absolute; top: 5em; display: flex;flex-direction: column; justify-content: center; align-items: center">
                    <div class="" style="border: 0; margin: 0">Commission</div>
                    <div style="display: flex; align-items: center">
                        <input id="create-bet-commission" style="font-size: 1em; margin: 0.5rem;" inputmode="decimal"/>
                        <div class="info" style="color: #f3f9d2; background-color: transparent">%</div>
                    </div>
                    <label id="create-bet-commission-label" for="create-bet-commission">
                        Will be taken when winners collect their earnings.
                    </label>
                </div>
                <div class="create-bet-step"
                     style="visibility: hidden; opacity: 0; transition: opacity 0.5s linear; position: absolute; top: 5em; display: flex;flex-direction: column; justify-content: center; align-items: center">
                    <div class="" style="border: 0; margin: 0">Initial pool</div>
                    <div style="display: flex; align-items: center">
                        <input id="create-bet-initial-pool" inputmode="decimal" style="margin: 0.5rem;"/>
                        <div class="info" style="color: #f3f9d2; background-color: transparent">USDC</div>
                    </div>
                    <label for="create-bet-initial-pool">
                        An initial pool incentivizes people to participate, but is not mandatory.
                    </label>
                </div>
                <div class="create-bet-step"
                     style="visibility: hidden; opacity: 0; transition: opacity 0.5s linear; position: absolute; top: 5em; display: flex; flex-direction: column; justify-content: center; align-items: center">
                    <div class="" style="border: 0; margin: 0">Dates</div>
                    <input id="deadline-date" type="datetime-local" style="margin: 0.5rem;"
                           onfocus="this.min=new Date().toISOString();this.max=new Date(new Date().getTime() + 60 * 24 * 3600000).toISOString()"/>
                    <label for="deadline-date">When will the pool be locked?</label>

                    <input id="schedule-date" type="datetime-local" style="margin: 0.5rem;"
                           onfocus="this.min=new Date().toISOString().split('T')[0];this.max=new Date(new Date().getTime() + 60 * 24 * 3600000).toISOString().split('T')[0]"/>
                    <label for="schedule-date">When is the bet able to be settled?</label>
                    <button class="btn link" onclick="createBet()">Create Market</button>
                </div>
            </div>
            <div class="btn" style="color:white; background-color: #ed7b64; align-self: flex-start;"
                 onclick="renderNextCreationStep()">→
            </div>
            <button class="btn close" onclick="closeNewBet()"
                    style="align-self: flex-start; border-radius: 5rem; padding: 0.25rem;">
                ✖
            </button>
        </div>
        <div id="bet-container" style="margin-top: 3%; display: none">
            <div id="place-bet-info" style="display: none; flex-direction: row; width: 100%; justify-content: flex-end">
                <table class="styled-table" style="width: auto">
                    <thead>
                    <tr>
                        <th colspan="6" style="text-align: center;">Placed Orders</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th>Position</th>
                        <th>Outcome</th>
                        <th>Amount</th>
                        <th>Payout</th>
                        <th>Total cost</th>
                    </tr>
                    </thead>
                    <tbody id="place-bet-entries"></tbody>
                </table>
                <button class="btn link" id="place-bet" onclick="buyBet()"></button>
            </div>
            <div>
                <div id="about-bet" style="font-size: 150%">About</div>
            </div>
            <div id="bet-operations"
                 style="display: flex; flex-direction: row; justify-content: space-around; width: 100%">
                <div style="display: flex; width: 100%; justify-content: space-around">
                    <table class="styled-table" style="box-shadow: none; width: auto">
                        <thead>
                        <tr>
                            <th>Outcome</th>
                            <th>Owned</th>
                            <th>Odds</th>
                            <th>Mkt. Price</th>
                            <th>Avg. Price</th>
                            <th>Payout</th>
                        </tr>
                        </thead>
                        <tbody id="market-prices"></tbody>
                    </table>
                    <div style="">
                        <canvas id="bet-pool"></canvas>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center">
                        <div id="bet-decision">
                            <label for="decide-bet-outcome">
                                <button class="btn link" id="decide-bet" onclick="decideBet()">Bet Decision</button>
                            </label>
                            <input name="decide-bet-outcome" id="decide-bet-outcome"/>
                        </div>
                        <div id="place-bet-data-container" style="display: flex; flex-direction: row; justify-content: center; align-items: center">
                            <button class="btn link" id="queue-buy-order" style="opacity: 1; cursor: pointer; display: block;">Add</button>
                            <div id="place-bet-amount-container">
                                <label for="place-bet-amount"></label>
                                <input name="place-bet-amount" id="place-bet-amount" oninput="renderPlaceSingleBet()" type="number" step="0.0001" placeholder="# of Shares" size="11">
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; height: 33%; margin: 10%; justify-content: flex-end; width: 100%">
                                <div id="place-bet-choice-container" style="display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start;margin: 10%;">
                                    <label style="font-size: 0.7rem" for="choose-bet-inputs">Outcome</label>
                                    <select id="choose-bet-inputs" style="color: rgb(243, 249, 210); display: block;" onchange="renderPlaceSingleBet()"><option value="Sergio Massa">Sergio Massa</option><option value="Patricia Bullrich">Patricia Bullrich</option><option value="Javier Milei">Javier Milei</option></select>
                                </div>
                                <div id="place-bet-position-container" style="display: flex; flex-direction: column; justify-content: flex-end; align-items: flex-start;width: 100%;">
                                    <label style="font-size: 0.7rem" for="choose-bet-position">Position</label>
                                    <select id="choose-bet-position" style="color: #f3f9d2" onchange="renderPlaceSingleBet()">
                                        <option value="buy">Buy</option>
                                        <option value="sell">Sell</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex">
                            <div id="place-bet-inputs" style="display: flex; flex-direction: column">
                                <label for="place-bet-outcome">Outcome</label>
                                <input name="place-bet-outcome" id="place-bet-outcome" type="text"
                                       oninput="renderPlaceSingleBet()" placeholder="Expected outcome"/>
                            </div>
                            <button class="btn link" id="claim-bet" onclick="claimReward()"></button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="bet-pool-container" style="justify-content: space-around; width: 100%; display: flex; margin: 1%">
                <div class="msg details" id="oo-bet"
                     style="display: flex; justify-content: center; align-items: center; width: 50%; flex-direction: column;">
                    <div style="margin-bottom: 0.25rem; font-size: 0.8rem">Terms</div>
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; border: 0; border-radius: 0">
                        <div id="bet-oo-query"></div>
                    </div>
                    <div id="bet-outcome"
                         style="margin-top: 1rem; display: flex; flex-direction: column; border: 0; border-radius: 0">
                        <div style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                            Outcome
                        </div>
                        <div id="bet-inner-outcome"></div>
                    </div>
                </div>
                <div class="msg details" style="flex-direction: column;">
                    <div style="font-size: 0.9rem">Timeline (UTC)</div>
                    <div
                            style="margin-top: 1rem; display: flex; flex-direction: column; align-items: space-around; justify-content: center; border: 0; border-radius: 0">
                        <div style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                            Schedule
                        </div>
                        <div id="bet-schedule"></div>
                    </div>
                    <div
                            style="margin-top: 1rem; display: flex; flex-direction: column; border: 0; border-radius: 0">
                        <div style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                            Lockout
                        </div>
                        <div id="bet-deadline"></div>
                    </div>
                </div>
                <div class="msg details" style="flex-direction: column;">
                    <div style="font-size: 0.9rem">Pool</div>
                    <div
                            style="margin-top: 1rem; display: flex; flex-direction: column; border: 0; border-radius: 0">
                        <div id="bet-total-pool"></div>
                    </div>
                    <div
                            style="margin-top: 1rem; display: flex; flex-direction: column; border: 0; border-radius: 0">
                        <div style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                            Commission
                        </div>
                        <div id="bet-commission"></div>
                    </div>
                </div>
            </div>
            <div style="display: flex; justify-content: space-around; width: 100%">
                <div id="user-orders" style="width: 100%">
                    <div style="display: flex; justify-content: center">Open orders</div>
                    <div style="display: flex; justify-content: center; align-items: flex-start">
                        <table style="width: 33%; background-color: #ff4747" id="user-sell-orders">
                            <thead>
                            <tr>
                                <th colspan="3" style="text-align: center;">Sells</th>
                            </tr>
                            <tr>
                                <th>Outcome</th>
                                <th>#</th>
                                <th>$</th>
                            </tr>
                            </thead>
                            <tbody id="user-sell-orders-entries"></tbody>
                        </table>
                        <table style="width: 33%; background-color: #069b69" id="user-buy-orders">
                            <thead>
                            <tr>
                                <th colspan="3" style="text-align: center;">Buys</th>
                            </tr>
                            <tr>
                                <th>Outcome</th>
                                <th>#</th>
                                <th>$</th>
                            </tr>
                            </thead>
                            <tbody id="user-buy-orders-entries"></tbody>
                        </table>
                    </div>
                </div>
                <div style="width: 100%">
                    <div style="display: flex; justify-content: center">Order book</div>
                    <div style="display: flex; justify-content: center; align-items: flex-start">
                        <table style="width: 33%; background-color: #ff4747" id="pool-sell-orders">
                            <thead>
                            <tr>
                                <th colspan="3" style="text-align: center;">Sells</th>
                            </tr>
                            <tr>
                                <th>Outcome</th>
                                <th>#</th>
                                <th>$</th>
                            </tr>
                            </thead>
                            <tbody id="pool-sell-orders-entries"></tbody>
                        </table>
                        <table style="width: 33%; background-color: #069b69" id="pool-buy-orders">
                            <thead>
                            <tr>
                                <th colspan="3" style="text-align: center;">Buys</th>
                            </tr>
                            <tr>
                                <th>Outcome</th>
                                <th>#</th>
                                <th>$</th>
                            </tr>
                            </thead>
                            <tbody id="pool-buy-orders-entries"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="bet-info"
                 style="margin: 1em 0; width: 100%; display:flex; justify-content: space-around; align-items: center">
                <div id="url-bet" class="msg details" style="flex-direction: column;">
                    <div style="font-size: 0.9rem">Query</div>
                    <div
                            style="margin-top: 1rem; font-size: 0.7rem; display: flex; flex-direction: column; align-items: space-around; justify-content: center; border: 0; border-radius: 0">
                        <div id="bet-query"></div>
                    </div>
                    <div
                            style="margin-top: 1rem; font-size: 0.7rem; display: flex; flex-direction: column; align-items: space-around; justify-content: center; border: 0; border-radius: 0">
                        <div style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                            URL
                        </div>
                        <div id="bet-url"></div>
                    </div>
                    <div
                            style="margin-top: 1rem; font-size: 0.7rem; display: flex; flex-direction: column; border: 0; border-radius: 0">
                        <div style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                            Schema
                        </div>
                        <div id="bet-schema"></div>
                    </div>
                    <div
                            style="margin-top: 1rem; font-size: 0.7rem; display: flex; flex-direction: column; border: 0; border-radius: 0">
                        <div style="font-size: 0.8rem; margin-bottom: 0.25rem;">
                            Path
                        </div>
                        <div id="bet-path"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="intro"
             style="margin: 1rem; width: 65vw; flex-direction: column; display: flex; justify-content: center;">
            <div>
                <h3>What is this?</h3>
                <p>
                    A fully decentralized, blockchain-based web application in which anyone can participate on or
                    create their own parimutuel betting pools.
                </p>
            </div>
            <div id="active-bets">

            </div>
            <div>
                <h3>Show me an example</h3>
                <p>
                    <a style="font-weight: bold" href="/?id=argentina-2023-election">Who will be elected Argentina's
                        2024 president?</a>
                </p>
            </div>
            <div>
                <h3>How do I sign up?</h3>
                <p>
                    You can't! User interaction is entirely blockchain based, so using Gambeth is as
                    simple as
                    having <a href="https://metamask.io/">MetaMask</a> installed and some funds in your account.
                </p>
            </div>
            <div>
                <h3>Who determines the outcome of a bet?</h3>
                <p>
                    Gambeth uses UMA's decentralized oracle service under the hood to determine the resolution for each
                    market.
                    This oracle has been battle-tested in several dApps, Polymarket being the most well known one.
                </p>
            </div>
            <div>
                <h3>How do I place a bet?</h3>
                <ul>
                    <li>
                        Search for the ID of the bet you want to participate in (check the bet's info to make
                        sure everything looks good).
                    </li>
                    <li>
                        Choose your predicted outcome and how many shares you'd like to buy, then click the "+" button
                        to add your pending order.
                    </li>
                    <li>
                        Once all your placed orders are ready, click the "Place orders" button and approve the transaction!
                    </li>
                </ul>
            </div>
            <div id="what-happens-if-i-win">
                <h3>What happens if I win?</h3>
                <p>
                    First of all, congratulations! After the bet has been executed and the outcome uploaded to the
                    blockchain, all you need to do is lookup the bet's ID in Gambeth and click on the "Claim Bet"
                    button.
                    Your earnings will be dependent on two factors: your share of the winner's pool, and the bet's
                    commission costs.
                </p>
            </div>
            <div>
                <h3>What happens if no one wins or if the bet fails to resolve?</h3>
                <p>In both cases you can simply reclaim your funds.</p>
            </div>
            <div id="create-bet-info">
                <h3>How do I create a bet?</h3>
                <p>
                    Click the "Create Market" button and you'll be presented with all the information you need to
                    complete
                    when creating a market.
                    If you'd like to get people interested in your market, a great way to do so is setting up an initial
                    pool!
                </p>
            </div>
        </div>
    </div>
</div>
<script src="gambeth.js"></script>
</body>
